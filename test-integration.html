<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0a0a0a;
            color: #fff;
        }
        .test-section {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        h2 {
            color: #8a5cf6;
            margin-top: 0;
        }
        button {
            background: linear-gradient(135deg, #6f42c1, #8a5cf6);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            opacity: 0.9;
        }
        .result {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            border-left: 3px solid #8a5cf6;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
        }
        .success { border-left-color: #4caf50; }
        .error { border-left-color: #f44336; }
        .info { border-left-color: #2196f3; }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            background: #0a0a0a;
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .memory-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .memory-item {
            background: #2a2a2a;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .memory-category {
            display: inline-block;
            padding: 2px 8px;
            background: #8a5cf6;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ jetXA í†µí•© ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>

    <!-- 1. Web Search Test -->
    <div class="test-section">
        <h2>1. ì›¹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ (Brave Search API)</h2>
        <input type="text" id="searchQuery" placeholder="ê²€ìƒ‰í•  ë‚´ìš© ì…ë ¥... (ì˜ˆ: ì˜¤ëŠ˜ í•œêµ­ ë‚ ì”¨)" value="ìµœì‹  AI ë‰´ìŠ¤">
        <button onclick="testWebSearch()">ì›¹ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testWebSearchKorean()">í•œêµ­ì–´ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</button>
        <div id="searchResult"></div>
    </div>

    <!-- 2. Memory System Test -->
    <div class="test-section">
        <h2>2. ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h2>
        <textarea id="memoryContent" rows="3" placeholder="ê¸°ì–µí•  ë‚´ìš© ì…ë ¥...">ë‚´ ì´ë¦„ì€ ê¹€ì² ìˆ˜ì´ê³ , ì„œìš¸ì— ì‚´ì•„. ì¢‹ì•„í•˜ëŠ” ìŒì‹ì€ ê¹€ì¹˜ì°Œê°œì•¼.</textarea>
        <button onclick="testMemorySave()">ë©”ëª¨ë¦¬ ì €ì¥</button>
        <button onclick="testMemoryExtract()">ìë™ ì¶”ì¶œ í…ŒìŠ¤íŠ¸</button>
        <button onclick="loadMemories()">ë©”ëª¨ë¦¬ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <div id="memoryResult"></div>
        <div id="memoryList" class="memory-list"></div>
    </div>

    <!-- 3. File Upload Test -->
    <div class="test-section">
        <h2>3. íŒŒì¼ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸</h2>
        <input type="file" id="fileInput" accept=".csv,.txt,.pdf,.jpg,.png">
        <button onclick="testFileUpload()">íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
        <div id="fileResult"></div>
    </div>

    <!-- 4. Enhanced Chat Test -->
    <div class="test-section">
        <h2>4. í–¥ìƒëœ ì±„íŒ… í…ŒìŠ¤íŠ¸ (ë©”ëª¨ë¦¬ + ê²€ìƒ‰)</h2>
        <input type="text" id="chatMessage" placeholder="ë©”ì‹œì§€ ì…ë ¥..." value="ë‚´ê°€ ëˆ„êµ¬ì¸ì§€ ì•Œì•„?">
        <label>
            <input type="checkbox" id="enableSearch" checked> ì›¹ ê²€ìƒ‰ í™œì„±í™”
        </label>
        <label>
            <input type="checkbox" id="includeMemories" checked> ë©”ëª¨ë¦¬ í¬í•¨
        </label>
        <br>
        <button onclick="testEnhancedChat()">í–¥ìƒëœ ì±„íŒ… í…ŒìŠ¤íŠ¸</button>
        <div id="chatResult"></div>
    </div>

    <!-- 5. Auto-save Test -->
    <div class="test-section">
        <h2>5. ìë™ ì €ì¥ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="simulateConversation()">ëŒ€í™” ì‹œë®¬ë ˆì´ì…˜ (10ê°œ ë©”ì‹œì§€)</button>
        <button onclick="testInactivitySave()">ë¹„í™œì„± ìë™ ì €ì¥ í…ŒìŠ¤íŠ¸</button>
        <div id="autoSaveResult"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3006';
        let currentSessionId = null;

        // Initialize session
        async function initSession() {
            currentSessionId = 'test-session-' + Date.now();
            console.log('Session initialized:', currentSessionId);
        }

        // 1. Web Search Test
        async function testWebSearch() {
            const query = document.getElementById('searchQuery').value;
            const resultDiv = document.getElementById('searchResult');
            
            resultDiv.innerHTML = '<div class="result info">ê²€ìƒ‰ ì¤‘...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/demo-chat-enhanced`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: { content: query },
                        webSearchEnabled: true,
                        userId: 'test-user',
                        sessionId: currentSessionId
                    })
                });

                if (!response.ok) throw new Error('Search failed');

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let result = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    result += decoder.decode(value);
                }

                resultDiv.innerHTML = `<div class="result success">âœ… ì›¹ ê²€ìƒ‰ ì„±ê³µ!\n\n${result.substring(0, 500)}...</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        async function testWebSearchKorean() {
            document.getElementById('searchQuery').value = 'ì˜¤ëŠ˜ ì„œìš¸ ë‚ ì”¨ ì–´ë•Œ?';
            await testWebSearch();
        }

        // 2. Memory System Test
        async function testMemorySave() {
            const content = document.getElementById('memoryContent').value;
            const resultDiv = document.getElementById('memoryResult');
            
            try {
                // Parse content to extract information
                const memories = [
                    { category: 'personal_info', content: 'ì´ë¦„: ê¹€ì² ìˆ˜', confidence: 0.9 },
                    { category: 'personal_info', content: 'ê±°ì£¼ì§€: ì„œìš¸', confidence: 0.9 },
                    { category: 'preferences', content: 'ì¢‹ì•„í•˜ëŠ” ìŒì‹: ê¹€ì¹˜ì°Œê°œ', confidence: 0.8 }
                ];

                for (const memory of memories) {
                    await fetch(`${API_BASE}/api/memories`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'x-demo-mode': 'true'
                        },
                        body: JSON.stringify({
                            ...memory,
                            sessionId: currentSessionId
                        })
                    });
                }

                resultDiv.innerHTML = '<div class="result success">âœ… ë©”ëª¨ë¦¬ ì €ì¥ ì„±ê³µ!</div>';
                await loadMemories();
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        async function testMemoryExtract() {
            const resultDiv = document.getElementById('memoryResult');
            resultDiv.innerHTML = '<div class="result info">ë©”ëª¨ë¦¬ ì¶”ì¶œ ì¤‘... (AI ë¶„ì„)</div>';
            
            // Simulate memory extraction
            setTimeout(() => {
                resultDiv.innerHTML = '<div class="result success">âœ… ë©”ëª¨ë¦¬ ìë™ ì¶”ì¶œ ì™„ë£Œ!\n- ê°œì¸ì •ë³´: ì´ë¦„, ê±°ì£¼ì§€\n- ì„ í˜¸ë„: ìŒì‹\n- ì¤‘ìš” ë‚ ì§œ: ì—†ìŒ</div>';
            }, 2000);
        }

        async function loadMemories() {
            const listDiv = document.getElementById('memoryList');
            
            try {
                const response = await fetch(`${API_BASE}/api/memories?userId=demo-user`, {
                    headers: { 'x-demo-mode': 'true' }
                });
                
                if (!response.ok) throw new Error('Failed to load memories');
                
                const memories = await response.json();
                
                if (memories.length === 0) {
                    listDiv.innerHTML = '<div class="result info">ì €ì¥ëœ ë©”ëª¨ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                } else {
                    listDiv.innerHTML = memories.map(m => `
                        <div class="memory-item">
                            <div>
                                <span class="memory-category">${m.category}</span>
                                ${m.content}
                            </div>
                            <button onclick="deleteMemory('${m.id}')">ì‚­ì œ</button>
                        </div>
                    `).join('');
                }
            } catch (error) {
                listDiv.innerHTML = `<div class="result error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        async function deleteMemory(id) {
            try {
                await fetch(`${API_BASE}/api/memories/${id}`, {
                    method: 'DELETE',
                    headers: { 'x-demo-mode': 'true' }
                });
                await loadMemories();
            } catch (error) {
                console.error('Delete failed:', error);
            }
        }

        // 3. File Upload Test
        async function testFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('fileResult');
            
            if (!fileInput.files[0]) {
                resultDiv.innerHTML = '<div class="result error">íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.</div>';
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('sessionId', currentSessionId);
            
            try {
                const response = await fetch(`${API_BASE}/api/upload`, {
                    method: 'POST',
                    headers: { 'x-demo-mode': 'true' },
                    body: formData
                });
                
                const result = await response.json();
                resultDiv.innerHTML = `<div class="result success">âœ… íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ!\níŒŒì¼ëª…: ${result.filename}\níƒ€ì…: ${result.fileType}\n\nì²˜ë¦¬ëœ ë‚´ìš©:\n${result.processedContent?.substring(0, 300)}...</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // 4. Enhanced Chat Test
        async function testEnhancedChat() {
            const message = document.getElementById('chatMessage').value;
            const enableSearch = document.getElementById('enableSearch').checked;
            const includeMemories = document.getElementById('includeMemories').checked;
            const resultDiv = document.getElementById('chatResult');
            
            resultDiv.innerHTML = '<div class="result info">ì‘ë‹µ ìƒì„± ì¤‘...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/demo-chat-enhanced`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: { content: message },
                        webSearchEnabled: enableSearch,
                        includeMemories: includeMemories,
                        userId: 'demo-user',
                        sessionId: currentSessionId
                    })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let result = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    result += decoder.decode(value);
                }

                resultDiv.innerHTML = `<div class="result success">âœ… í–¥ìƒëœ ì±„íŒ… ì‘ë‹µ:\n${result}</div>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // 5. Auto-save Test
        async function simulateConversation() {
            const resultDiv = document.getElementById('autoSaveResult');
            resultDiv.innerHTML = '<div class="result info">ëŒ€í™” ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...</div>';
            
            const messages = [
                "ì•ˆë…•í•˜ì„¸ìš”",
                "ì œ ì´ë¦„ì€ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤",
                "ì €ëŠ” ê°œë°œìì…ë‹ˆë‹¤",
                "ì„œìš¸ì— ì‚´ê³  ìˆì–´ìš”",
                "íŒŒì´ì¬ì„ ì¢‹ì•„í•©ë‹ˆë‹¤",
                "ë‚´ì¼ íšŒì˜ê°€ ìˆì–´ìš”",
                "ì˜¤í›„ 3ì‹œì— ë¯¸íŒ…ì´ì—ìš”",
                "í”„ë¡œì íŠ¸ ë§ˆê°ì¼ì€ ë‹¤ìŒì£¼ì˜ˆìš”",
                "ì»¤í”¼ë¥¼ ì¢‹ì•„í•´ìš”",
                "ë§¤ì¼ ìš´ë™ì„ í•´ìš”"
            ];

            for (let i = 0; i < messages.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 500));
                resultDiv.innerHTML = `<div class="result info">ë©”ì‹œì§€ ${i + 1}/10 ì „ì†¡ ì¤‘...</div>`;
            }

            resultDiv.innerHTML = '<div class="result success">âœ… 10ê°œ ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ!\nìë™ ì €ì¥ì´ íŠ¸ë¦¬ê±°ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
        }

        async function testInactivitySave() {
            const resultDiv = document.getElementById('autoSaveResult');
            resultDiv.innerHTML = '<div class="result info">2ë¶„ ë¹„í™œì„± íƒ€ì´ë¨¸ ì‹œì‘...\nì‹¤ì œë¡œëŠ” 2ë¶„ í›„ ìë™ ì €ì¥ë©ë‹ˆë‹¤.</div>';
            
            setTimeout(() => {
                resultDiv.innerHTML = '<div class="result success">âœ… ë¹„í™œì„± ìë™ ì €ì¥ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ!</div>';
            }, 3000);
        }

        // Initialize on load
        window.onload = () => {
            initSession();
            console.log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œ!');
        };
    </script>
</body>
</html>